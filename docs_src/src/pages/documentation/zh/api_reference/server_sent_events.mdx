export const description =
  'å­¦ä¹ å¦‚ä½•åœ¨ Robyn ä¸­å®ç°æœåŠ¡å™¨å‘é€äº‹ä»¶ (SSE)ï¼Œç”¨äºå®æ—¶çš„æœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯é€šä¿¡ã€‚'

## æœåŠ¡å™¨å‘é€äº‹ä»¶ (SSE) {{ tag: 'SSE', label: 'Server-Sent Events' }}

<Row>
<Col>
åœ¨å­¦ä¹ äº†[è¡¨å•æ•°æ®å¤„ç†](/documentation/zh/api_reference/form_data)ä¹‹åï¼Œè™è ä¾ æ„è¯†åˆ°ä»–éœ€è¦ä¸€ç§æ–¹æ³•æ¥å‘ä»–çš„çŠ¯ç½ªç›‘æ§ä»ªè¡¨æ¿æ¨é€å®æ—¶æ›´æ–°ã€‚çŠ¯ç½ªåˆ†å­ä¸ä¼šç­‰å¾…è™è ä¾ åˆ·æ–°æµè§ˆå™¨ï¼

ä»–å‘ç°äº†æœåŠ¡å™¨å‘é€äº‹ä»¶ (SSE) - ä¸€ä¸ªå®Œç¾çš„è§£å†³æ–¹æ¡ˆï¼Œç”¨äºé€šè¿‡ HTTP è¿›è¡ŒæœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯çš„å•å‘é€šä¿¡ã€‚SSE å…è®¸è™è ä¾ å°†å®æ—¶æ•°æ®æµå¼ä¼ è¾“åˆ°ä»–çš„ä»ªè¡¨æ¿ï¼Œè€Œæ— éœ€å®Œæ•´åŒå‘é€šä¿¡çš„å¤æ‚æ€§ã€‚

"è¿™æ­£æ˜¯æˆ‘çš„çŠ¯ç½ªè­¦æŠ¥ç³»ç»Ÿæ‰€éœ€è¦çš„ï¼"è™è ä¾ æƒŠå‘¼é“ã€‚"æˆ‘å¯ä»¥åœ¨æ£€æµ‹åˆ°æ–°çŠ¯ç½ªæ—¶ç«‹å³å‘ä»ªè¡¨æ¿æ¨é€æ›´æ–°ã€‚"

æœåŠ¡å™¨å‘é€äº‹ä»¶éå¸¸é€‚åˆï¼š
- å®æ—¶é€šçŸ¥
- å®æ—¶æ•°æ®æº
- è¿›åº¦æ›´æ–°
- èŠå¤©åº”ç”¨ç¨‹åºï¼ˆä»…æœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯ï¼‰
- ä»ªè¡¨æ¿æ›´æ–°
- æ—¥å¿—æµå¼ä¼ è¾“
</Col>
<Col sticky>

<CodeGroup title="SSE å“åº”" tag="GET" label="/events">

```python {{ title: 'åŸºæœ¬ SSE æµ' }}
from robyn import Robyn, SSE_Response, SSE_Message
import time

app = Robyn(__file__)

@app.get("/events")
def stream_events(request):
    def event_generator():
        for i in range(10):
            yield SSE_Message(f"äº‹ä»¶ {i}", id=str(i))
            time.sleep(1)
    
    return SSE_Response(event_generator())
```

```python {{ title: 'JSON æ•°æ®æµ' }}
from robyn import Robyn, SSE_Response, SSE_Message
import json
import time

app = Robyn(__file__)

@app.get("/events/json")
def stream_json_events(request):
    def json_event_generator():
        for i in range(5):
            data = {
                "id": i,
                "message": f"æ›´æ–° {i}",
                "timestamp": time.time()
            }
            yield SSE_Message(
                json.dumps(data), 
                event="update", 
                id=str(i)
            )
            time.sleep(2)
    
    return SSE_Response(json_event_generator())
```

</CodeGroup>
</Col>
</Row>

---

## SSE æ¶ˆæ¯æ ¼å¼ {{ tag: 'SSE_Message', label: 'Message Format' }}

<Row>
<Col>
`SSE_Message` ç±»æä¾›äº†ä¸€ç§ç»“æ„åŒ–çš„æ–¹å¼æ¥æ ¼å¼åŒ–æœåŠ¡å™¨å‘é€äº‹ä»¶ã€‚æ‚¨å¯ä»¥æŒ‡å®šæ¶ˆæ¯æ•°æ®ã€äº‹ä»¶ç±»å‹å’Œå”¯ä¸€æ ‡è¯†ç¬¦ã€‚

**SSE_Message å‚æ•°ï¼š**
- `data`: æ¶ˆæ¯å†…å®¹ï¼ˆå¿…éœ€ï¼‰
- `event`: ç”¨äºå®¢æˆ·ç«¯è¿‡æ»¤çš„äº‹ä»¶ç±»å‹ï¼ˆå¯é€‰ï¼‰
- `id`: æ¶ˆæ¯çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆå¯é€‰ï¼‰
- `retry`: é‡è¿æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼ˆå¯é€‰ï¼‰
</Col>
<Col sticky>

<CodeGroup title="SSE æ¶ˆæ¯" tag="SSE_Message" label="æ¶ˆæ¯ç±»å‹">

```python {{ title: 'ç®€å•æ¶ˆæ¯' }}
from robyn import SSE_Message

# åªæœ‰æ•°æ®çš„åŸºæœ¬æ¶ˆæ¯
message = SSE_Message("ä½ å¥½ï¼Œè™è ä¾ ï¼")

# å¸¦æœ‰äº‹ä»¶ç±»å‹çš„æ¶ˆæ¯
message = SSE_Message("çŠ¯ç½ªè­¦æŠ¥ï¼", event="alert")

# å¸¦æœ‰ ID çš„æ¶ˆæ¯ç”¨äºå®¢æˆ·ç«¯è·Ÿè¸ª
message = SSE_Message("çŠ¶æ€æ›´æ–°", id="status-1")
```

```python {{ title: 'å®Œæ•´æ¶ˆæ¯' }}
from robyn import SSE_Message

# åŒ…å«æ‰€æœ‰å‚æ•°çš„å®Œæ•´æ¶ˆæ¯
message = SSE_Message(
    data="ç³»ç»Ÿæ­£å¸¸è¿è¡Œ",
    event="status",
    id="sys-001",
    retry=5000  # 5 ç§’
)
```

</CodeGroup>
</Col>
</Row>

---

## å‘½åäº‹ä»¶ {{ tag: 'NamedEvents', label: 'Named Events' }}

<Row>
<Col>
è™è ä¾ å¯ä»¥å‘ä»–çš„ä»ªè¡¨æ¿å‘é€ä¸åŒç±»å‹çš„äº‹ä»¶ï¼Œå…è®¸å®¢æˆ·ç«¯ä»¥ä¸åŒçš„æ–¹å¼å¤„ç†æ¯ç§äº‹ä»¶ç±»å‹ã€‚è¿™å¯¹äºéœ€è¦åŒºåˆ†ä¸åŒç±»å‹æ›´æ–°çš„åº”ç”¨ç¨‹åºç‰¹åˆ«æœ‰ç”¨ã€‚
</Col>
<Col sticky>

<CodeGroup title="å‘½åäº‹ä»¶" tag="GET" label="/events/named">

```python {{ title: 'å¤šç§äº‹ä»¶ç±»å‹' }}
from robyn import Robyn, SSE_Response, SSE_Message
import time

app = Robyn(__file__)

@app.get("/events/named")
def stream_named_events(request):
    def named_event_generator():
        events = [
            ("alert", "å°ä¸‘åœ¨å¸‚ä¸­å¿ƒè¢«å‘ç°"),
            ("update", "è­¦å¯Ÿå•ä½å·²æ´¾é£"),
            ("status", "æƒ…å†µå·²æ§åˆ¶"),
            ("alert", "æ–°çŠ¯ç½ªæŠ¥å‘Š"),
        ]
        
        for event_type, message in events:
            yield SSE_Message(
                message, 
                event=event_type, 
                id=f"{event_type}-{time.time()}"
            )
            time.sleep(1.5)
    
    return SSE_Response(named_event_generator())
```

```python {{ title: 'å®¢æˆ·ç«¯ JavaScript' }}
// HTML/JavaScript å®¢æˆ·ç«¯ä»£ç 
const eventSource = new EventSource('/events/named');

// ç›‘å¬ç‰¹å®šäº‹ä»¶ç±»å‹
eventSource.addEventListener('alert', function(event) {
    console.log('è­¦æŠ¥:', event.data);
    showAlert(event.data);
});

eventSource.addEventListener('update', function(event) {
    console.log('æ›´æ–°:', event.data);
    updateStatus(event.data);
});

eventSource.addEventListener('status', function(event) {
    console.log('çŠ¶æ€:', event.data);
    updateSystemStatus(event.data);
});
```

</CodeGroup>
</Col>
</Row>

---

## å¼‚æ­¥ SSE æµ {{ tag: 'AsyncSSE', label: 'Async Streams' }}

<Row>
<Col>
å¯¹äº I/O å¯†é›†å‹æ“ä½œæˆ–å½“è™è ä¾ éœ€è¦ä»å¤–éƒ¨æºè·å–æ•°æ®æ—¶ï¼Œå¼‚æ­¥ç”Ÿæˆå™¨é€šè¿‡ä¸é˜»å¡äº‹ä»¶å¾ªç¯æä¾›æ›´å¥½çš„æ€§èƒ½ã€‚
</Col>
<Col sticky>

<CodeGroup title="å¼‚æ­¥ SSE" tag="GET" label="/events/async">

```python {{ title: 'å¼‚æ­¥ç”Ÿæˆå™¨' }}
from robyn import Robyn, SSE_Response, SSE_Message
import asyncio
import time

app = Robyn(__file__)

@app.get("/events/async")
async def stream_async_events(request):
    async def async_event_generator():
        for i in range(8):
            # æ¨¡æ‹Ÿå¼‚æ­¥æ•°æ®åº“è°ƒç”¨
            await asyncio.sleep(0.5)
            
            yield SSE_Message(
                f"å¼‚æ­¥æ›´æ–° {i} - {time.strftime('%H:%M:%S')}", 
                event="async_update", 
                id=str(i)
            )
    
    return SSE_Response(async_event_generator())
```

```python {{ title: 'æ•°æ®åº“é›†æˆ' }}
from robyn import Robyn, SSE_Response, SSE_Message
import asyncio
import json

app = Robyn(__file__)

@app.get("/events/database")
async def stream_database_events(request):
    async def database_event_generator():
        while True:
            # æ¨¡æ‹Ÿå¼‚æ­¥æ•°æ®åº“æŸ¥è¯¢
            await asyncio.sleep(2)
            
            # è·å–æœ€æ–°çŠ¯ç½ªæŠ¥å‘Š
            crime_data = await get_latest_crimes()
            
            yield SSE_Message(
                json.dumps(crime_data),
                event="crime_update",
                id=f"crime-{time.time()}"
            )

async def get_latest_crimes():
    # æ¨¡æ‹Ÿæ•°æ®åº“è°ƒç”¨
    await asyncio.sleep(0.1)
    return {"location": "å“¥è°­å¹¿åœº", "type": "ç›—çªƒ"}
```

</CodeGroup>
</Col>
</Row>

---

## å®Œæ•´ç¤ºä¾‹ {{ tag: 'CompleteExample', label: 'Complete Example' }}

<Row>
<Col>
è¿™æ˜¯è™è ä¾ ä¸ºä»–çš„çŠ¯ç½ªç›‘æ§ä»ªè¡¨æ¿å®Œæ•´çš„ SSE å®ç°ï¼ŒåŒ…æ‹¬ä¸€ä¸ª HTML å®¢æˆ·ç«¯å’Œå¤šç§äº‹ä»¶ç±»å‹ã€‚
</Col>
<Col sticky>

<CodeGroup title="å®Œæ•´ç¤ºä¾‹" tag="Application" label="å®Œæ•´ SSE åº”ç”¨">

```python {{ title: 'æœåŠ¡å™¨å®ç°' }}
from robyn import Robyn, SSE_Response, SSE_Message, html
import time
import json

app = Robyn(__file__)

@app.get("/")
def index(request):
    return html("""
    <!DOCTYPE html>
    <html>
    <head>
        <title>è™è ä¾ çš„çŠ¯ç½ªä»ªè¡¨æ¿</title>
        <style>
            body { font-family: Arial, sans-serif; margin: 40px; }
            #events { border: 1px solid #ccc; padding: 20px; height: 400px; overflow-y: auto; }
            .event { margin: 5px 0; padding: 10px; border-radius: 5px; }
            .alert { background-color: #ffebee; border-left: 4px solid #f44336; }
            .update { background-color: #e8f5e8; border-left: 4px solid #4caf50; }
            .status { background-color: #e3f2fd; border-left: 4px solid #2196f3; }
        </style>
    </head>
    <body>
        <h1>ğŸ¦‡ è™è ä¾ çš„çŠ¯ç½ªä»ªè¡¨æ¿</h1>
        <div id="events"></div>
        
        <script>
            const eventSource = new EventSource('/events/dashboard');
            const eventsDiv = document.getElementById('events');
            
            eventSource.addEventListener('alert', function(event) {
                addEvent(event.data, 'alert');
            });
            
            eventSource.addEventListener('update', function(event) {
                addEvent(event.data, 'update');
            });
            
            eventSource.addEventListener('status', function(event) {
                addEvent(event.data, 'status');
            });
            
            function addEvent(data, type) {
                const eventDiv = document.createElement('div');
                eventDiv.className = 'event ' + type;
                eventDiv.innerHTML = '<strong>' + type.toUpperCase() + ':</strong> ' + data;
                eventsDiv.appendChild(eventDiv);
                eventsDiv.scrollTop = eventsDiv.scrollHeight;
            }
        </script>
    </body>
    </html>
    """)

@app.get("/events/dashboard")
def stream_dashboard_events(request):
    def dashboard_event_generator():
        # åˆå§‹çŠ¶æ€
        yield SSE_Message("ä»ªè¡¨æ¿å·²è¿æ¥", event="status")
        
        # æ¨¡æ‹Ÿå„ç§äº‹ä»¶
        events = [
            ("alert", "ğŸš¨ éŸ¦æ©åº„å›­å‘ç°çŠ¯ç½ª"),
            ("update", "ğŸ“¡ è­¦å¯Ÿå•ä½å·²æ´¾é£"),
            ("status", "ğŸ” æ­£åœ¨è°ƒæŸ¥å¯ç–‘æ´»åŠ¨"),
            ("alert", "âš ï¸ å°ä¸‘åœ¨å¸‚ä¸­å¿ƒè¢«å‘ç°"),
            ("update", "ğŸš” è¯·æ±‚æ”¯æ´"),
            ("status", "âœ… åŒºåŸŸå·²å®‰å…¨"),
        ]
        
        for event_type, message in events:
            yield SSE_Message(message, event=event_type, id=f"{event_type}-{time.time()}")
            time.sleep(2)
    
    return SSE_Response(dashboard_event_generator())

if __name__ == "__main__":
    app.start(host="0.0.0.0", port=8080)
```

</CodeGroup>
</Col>
</Row>

---

## æœ€ä½³å®è·µ {{ tag: 'BestPractices', label: 'Best Practices' }}

<Row>
<Col>
è™è ä¾ éµå¾ªè¿™äº›æœ€ä½³å®è·µæ¥ç¡®ä¿ä»–çš„ SSE å®ç°å¥å£®ã€å¯æ‰©å±•ä¸”æ˜“äºç»´æŠ¤ï¼š

**æ€§èƒ½ï¼š**
- å¯¹ I/O å¯†é›†å‹æ“ä½œä½¿ç”¨å¼‚æ­¥ç”Ÿæˆå™¨
- å®ç°é€‚å½“çš„è¿æ¥é™åˆ¶
- ä¸ºé•¿æ—¶é—´è¿è¡Œçš„æµæ·»åŠ å¿ƒè·³æœºåˆ¶

**é”™è¯¯å¤„ç†ï¼š**
- å§‹ç»ˆå°†ç”Ÿæˆå™¨åŒ…è£…åœ¨ try-catch å—ä¸­
- åœ¨é€‚å½“æ—¶å‘å®¢æˆ·ç«¯å‘é€é”™è¯¯æ¶ˆæ¯
- è®°å½•é”™è¯¯ä»¥ä¾¿è°ƒè¯•

**å®¢æˆ·ç«¯ï¼š**
- å®ç°é‡è¿é€»è¾‘
- é€‚å½“å¤„ç†ä¸åŒäº‹ä»¶ç±»å‹
- ä¸å†éœ€è¦æ—¶å…³é—­è¿æ¥

**å®‰å…¨æ€§ï¼š**
- éªŒè¯å®¢æˆ·ç«¯è¿æ¥
- å®ç°é€Ÿç‡é™åˆ¶
- åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ HTTPS
</Col>
<Col sticky>

<CodeGroup title="æœ€ä½³å®è·µ" tag="Tips" label="å®ç°æŠ€å·§">

```python {{ title: 'ç”Ÿäº§å°±ç»ª' }}
from robyn import Robyn, SSE_Response, SSE_Message
import time
import logging
from typing import Generator

app = Robyn(__file__)

# é…ç½®æ—¥å¿—
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

@app.get("/events/production")
def stream_production_events(request):
    def production_event_generator() -> Generator[SSE_Message, None, None]:
        client_id = request.headers.get("X-Client-ID", "unknown")
        logger.info(f"SSE å®¢æˆ·ç«¯å·²è¿æ¥: {client_id}")
        
        try:
            # å‘é€åˆå§‹è¿æ¥æ¶ˆæ¯
            yield SSE_Message(
                "å·²è¿æ¥åˆ°ç”Ÿäº§æµ",
                event="connected",
                id="conn-1"
            )
            
            # ä¸»äº‹ä»¶å¾ªç¯
            for i in range(100):  # é™åˆ¶äº‹ä»¶æ•°é‡
                try:
                    # æ‚¨çš„ä¸šåŠ¡é€»è¾‘åœ¨è¿™é‡Œ
                    data = get_production_data(i)
                    
                    yield SSE_Message(
                        data,
                        event="data_update",
                        id=f"data-{i}",
                        retry=5000  # 5 ç§’é‡è¯•
                    )
                    
                    time.sleep(1)
                    
                except Exception as e:
                    logger.error(f"SSE æµä¸­çš„é”™è¯¯: {e}")
                    yield SSE_Message(
                        "å‘ç”Ÿä¸´æ—¶é”™è¯¯",
                        event="error"
                    )
                    continue
                    
        except Exception as e:
            logger.error(f"SSE æµå´©æºƒ: {e}")
            yield SSE_Message(
                "ç”±äºé”™è¯¯æµå·²ç»“æŸ",
                event="stream_end"
            )
        finally:
            logger.info(f"SSE å®¢æˆ·ç«¯å·²æ–­å¼€è¿æ¥: {client_id}")
    
    return SSE_Response(production_event_generator())

def get_production_data(index: int) -> str:
    # æ¨¡æ‹Ÿæ•°æ®è·å–
    return f"ç”Ÿäº§æ•°æ® {index}"
```

</CodeGroup>
</Col>
</Row>

---

## æ¥ä¸‹æ¥åšä»€ä¹ˆï¼Ÿ

è™è ä¾ å·²ç»æŒæ¡äº†æœåŠ¡å™¨å‘é€äº‹ä»¶ï¼Œç°åœ¨å¯ä»¥å‘ä»–çš„çŠ¯ç½ªä»ªè¡¨æ¿æµå¼ä¼ è¾“å®æ—¶æ›´æ–°ã€‚è™½ç„¶ SSE éå¸¸é€‚åˆæœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯çš„å•å‘é€šä¿¡ï¼Œä½†è™è ä¾ æ„è¯†åˆ°ä»–éœ€è¦åŒå‘é€šä¿¡æ¥å®ç°æ›´å¤šäº¤äº’åŠŸèƒ½ï¼Œæ¯”å¦‚ä¸ä»–çš„ç›Ÿå‹è¿›è¡Œå®æ—¶èŠå¤©ã€‚

æ¥ä¸‹æ¥ï¼Œä»–æƒ³æ¢ç´¢å¦‚ä½•ä½¿ç”¨ [WebSocket](/documentation/zh/api_reference/websockets) å¤„ç†åŒå‘é€šä¿¡ï¼Œä»¥è·å¾—æ›´å¤šäº¤äº’åŠŸèƒ½ã€‚

å¦‚æœè™è ä¾ éœ€è¦å¤„ç†æ„å¤–æƒ…å†µï¼Œä»–å°†å­¦ä¹ [å¼‚å¸¸å¤„ç†](/documentation/zh/api_reference/exceptions)ä»¥ä½¿ä»–çš„åº”ç”¨ç¨‹åºæ›´åŠ å¥å£®ã€‚

ä¸ºäº†å°†ä»–çš„çŠ¯ç½ªç›‘æ§ç³»ç»Ÿæ‰©å±•åˆ°å¤šä¸ªè¿›ç¨‹ï¼Œè™è ä¾ å°†æ¢ç´¢[å¤šæ ¸æ‰©å±•](/documentation/zh/api_reference/scaling)ã€‚

---

**ä¸Šä¸€é¡µï¼š** [WebSocket](/documentation/zh/api_reference/websockets) - å­¦ä¹ å¦‚ä½•åœ¨ Robyn ä¸­ä½¿ç”¨ WebSocket  
**ä¸‹ä¸€é¡µï¼š** [å¼‚å¸¸å¤„ç†](/documentation/zh/api_reference/exceptions) - å­¦ä¹ å¦‚ä½•åœ¨ Robyn ä¸­å¤„ç†å¼‚å¸¸

å‡†å¤‡åœ¨æ‚¨çš„ Robyn åº”ç”¨ç¨‹åºä¸­å®ç°å®æ—¶åŠŸèƒ½äº†å—ï¼ŸæœåŠ¡å™¨å‘é€äº‹ä»¶æä¾›äº†ä¸€ç§ç®€å•è€Œå¼ºå¤§çš„æ–¹å¼æ¥ä»æœåŠ¡å™¨å‘å®¢æˆ·ç«¯æµå¼ä¼ è¾“æ•°æ®ï¼